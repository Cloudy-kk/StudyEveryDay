# react hook

## ç›®å½•

- [react hook](#react-hook)
  - [ç›®å½•](#ç›®å½•)
  - [userState](#userstate)
    - [1. åŸºç¡€ä½¿ç”¨](#1-åŸºç¡€ä½¿ç”¨)
    - [2. çŠ¶æ€çš„è¯»å–å’Œä¿®æ”¹](#2-çŠ¶æ€çš„è¯»å–å’Œä¿®æ”¹)
    - [3. ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹](#3-ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹)
    - [4. ä½¿ç”¨è§„åˆ™](#4-ä½¿ç”¨è§„åˆ™)
    - [æ‘˜è¦](#æ‘˜è¦)
    - [æ‰¹å¤„ç†](#æ‰¹å¤„ç†)
      - [åœ¨ä¸‹æ¬¡æ¸²æŸ“å‰å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ª state](#åœ¨ä¸‹æ¬¡æ¸²æŸ“å‰å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ª-state)
      - [å‘½åæƒ¯ä¾‹](#å‘½åæƒ¯ä¾‹)
    - [useState - å›è°ƒå‡½æ•°çš„å‚æ•°](#usestate---å›è°ƒå‡½æ•°çš„å‚æ•°)
  - [useEffect](#useeffect)
    - [*useEffect* ä¾èµ–é¡¹](#useeffect-ä¾èµ–é¡¹)
    - [ä¸€ã€ä¸ä¼ ä¾èµ–é¡¹](#ä¸€ä¸ä¼ ä¾èµ–é¡¹)
    - [äºŒã€ä¾èµ–é¡¹ä¸ºç©ºæ•°ç»„](#äºŒä¾èµ–é¡¹ä¸ºç©ºæ•°ç»„)
    - [ä¸‰ã€ä¾èµ–é¡¹ä¸ºéç©ºæ•°ç»„](#ä¸‰ä¾èµ–é¡¹ä¸ºéç©ºæ•°ç»„)
    - [å››ã€æ¸…ç†å‰¯ä½œç”¨](#å››æ¸…ç†å‰¯ä½œç”¨)
    - [äº”ã€useEffect - å‘é€ç½‘ç»œè¯·æ±‚](#äº”useeffect---å‘é€ç½‘ç»œè¯·æ±‚)
  - [useRef](#useref)
    - [ä½¿ç”¨åœºæ™¯](#ä½¿ç”¨åœºæ™¯)
    - [ä½¿ç”¨æ­¥éª¤](#ä½¿ç”¨æ­¥éª¤)
    - [è‡ªå®šä¹‰ä¸€ä¸ªhook](#è‡ªå®šä¹‰ä¸€ä¸ªhook)
  - [useMemo/useCallback](#usememousecallback)
  - [useContext](#usecontext)

## userState

> ğŸ“ŒTODOï¼šæºç é˜…è¯»

### 1. åŸºç¡€ä½¿ç”¨

**ä½œç”¨**

useStateä¸ºå‡½æ•°ç»„ä»¶æä¾›çŠ¶æ€ï¼ˆstateï¼‰

**ä½¿ç”¨æ­¥éª¤**

1. å¯¼å…¥ `useState` å‡½æ•°
2. è°ƒç”¨ `useState` å‡½æ•°ï¼Œå¹¶ä¼ å…¥çŠ¶æ€çš„åˆå§‹å€¼
3. ä»`useState`å‡½æ•°çš„è¿”å›å€¼ä¸­ï¼Œæ‹¿åˆ°çŠ¶æ€å’Œä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•
4. åœ¨JSXä¸­å±•ç¤ºçŠ¶æ€
5. è°ƒç”¨ä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•æ›´æ–°çŠ¶æ€

```react&#x20;tsx
import { useState } from 'react'

function App() {
  // å‚æ•°ï¼šçŠ¶æ€åˆå§‹å€¼æ¯”å¦‚,ä¼ å…¥ 0 è¡¨ç¤ºè¯¥çŠ¶æ€çš„åˆå§‹å€¼ä¸º 0
  // è¿”å›å€¼ï¼šæ•°ç»„,åŒ…å«ä¸¤ä¸ªå€¼ï¼š1 çŠ¶æ€å€¼ï¼ˆstateï¼‰ 2 ä¿®æ”¹è¯¥çŠ¶æ€çš„å‡½æ•°ï¼ˆsetStateï¼‰
  const [count, setCount] = useState(0)
  return (
    <button onClick={() => { setCount(count + 1) }}>{count}</button>
  )
}
export default App
```

### 2. çŠ¶æ€çš„è¯»å–å’Œä¿®æ”¹

**è¯»å–çŠ¶æ€**

è¯¥æ–¹å¼æä¾›çš„çŠ¶æ€ï¼Œæ˜¯å‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œå¯ä»¥åœ¨å‡½æ•°å†…çš„ä»»æ„ä½ç½®ä½¿ç”¨

**ä¿®æ”¹çŠ¶æ€**

1. setCountæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°è¡¨ç¤º`æœ€æ–°çš„çŠ¶æ€å€¼`
2. è°ƒç”¨è¯¥å‡½æ•°åï¼Œå°†ä½¿ç”¨æ–°å€¼æ›¿æ¢æ—§å€¼
3. ä¿®æ”¹çŠ¶æ€åï¼Œç”±äºçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œä¼šå¼•èµ·è§†å›¾å˜åŒ–

**æ³¨æ„äº‹é¡¹**

1. ä¿®æ”¹çŠ¶æ€çš„æ—¶å€™ï¼Œä¸€å®šè¦ä½¿ç”¨æ–°çš„çŠ¶æ€æ›¿æ¢æ—§çš„çŠ¶æ€ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹æ—§çš„çŠ¶æ€ï¼Œå°¤å…¶æ˜¯å¼•ç”¨ç±»å‹

### 3. ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹

`const [count, setCount] = useState(0);`

å‡½æ•°ç»„ä»¶ä½¿ç”¨ **useState** hook åçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä»¥åŠçŠ¶æ€å€¼çš„å˜åŒ–

- ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“
    1. ä»å¤´å¼€å§‹æ‰§è¡Œè¯¥ç»„ä»¶ä¸­çš„ä»£ç é€»è¾‘
    2. è°ƒç”¨ `useState(0)` å°†ä¼ å…¥çš„å‚æ•°ä½œä¸ºçŠ¶æ€åˆå§‹å€¼ï¼Œå³ï¼š0
    3. æ¸²æŸ“ç»„ä»¶ï¼Œæ­¤æ—¶ï¼Œè·å–åˆ°çš„çŠ¶æ€ count å€¼ä¸ºï¼š 0
- ç»„ä»¶ç¬¬äºŒæ¬¡æ¸²æŸ“
    1. ç‚¹å‡»æŒ‰é’®ï¼Œè°ƒç”¨ `setCount(count + 1)` ä¿®æ”¹çŠ¶æ€ï¼Œå› ä¸ºçŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€ä»¥ï¼Œè¯¥ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“
    2. ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œä¼šå†æ¬¡æ‰§è¡Œè¯¥ç»„ä»¶ä¸­çš„ä»£ç é€»è¾‘
    3. å†æ¬¡è°ƒç”¨ `useState(0)`ï¼Œæ­¤æ—¶ **React å†…éƒ¨ä¼šæ‹¿åˆ°æœ€æ–°çš„çŠ¶æ€å€¼è€Œéåˆå§‹å€¼**ï¼Œæ¯”å¦‚ï¼Œè¯¥æ¡ˆä¾‹ä¸­æœ€æ–°çš„çŠ¶æ€å€¼ä¸º 1
    4. å†æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œæ­¤æ—¶ï¼Œè·å–åˆ°çš„çŠ¶æ€ count å€¼ä¸ºï¼š1

æ³¨æ„ï¼š**useState çš„åˆå§‹å€¼(å‚æ•°)åªä¼šåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ç”Ÿæ•ˆ**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥åçš„æ¯æ¬¡æ¸²æŸ“ï¼ŒuseState è·å–åˆ°éƒ½æ˜¯æœ€æ–°çš„çŠ¶æ€å€¼ï¼ŒReact ç»„ä»¶ä¼šè®°ä½æ¯æ¬¡æœ€æ–°çš„çŠ¶æ€å€¼

### 4. ä½¿ç”¨è§„åˆ™

1. `useState` å‡½æ•°å¯ä»¥æ‰§è¡Œå¤šæ¬¡ï¼Œæ¯æ¬¡æ‰§è¡Œäº’ç›¸ç‹¬ç«‹ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ä¸ºå‡½æ•°ç»„ä»¶æä¾›ä¸€ä¸ªçŠ¶æ€
2. `useState` æ³¨æ„äº‹é¡¹

    åªèƒ½å‡ºç°åœ¨å‡½æ•°ç»„ä»¶æˆ–è€…å…¶ä»–hookå‡½æ•°ä¸­

    ä¸èƒ½åµŒå¥—åœ¨if/for/å…¶å®ƒå‡½æ•°ä¸­ï¼ˆreactæŒ‰ç…§hooksçš„è°ƒç”¨é¡ºåºè¯†åˆ«æ¯ä¸€ä¸ªhookï¼‰

### æ‘˜è¦

- å½“ä¸€ä¸ªç»„ä»¶éœ€è¦åœ¨å¤šæ¬¡æ¸²æŸ“é—´â€œè®°ä½â€æŸäº›ä¿¡æ¯æ—¶ä½¿ç”¨ state å˜é‡ã€‚
- State å˜é‡æ˜¯é€šè¿‡è°ƒç”¨ `useState` Hook æ¥å£°æ˜çš„ã€‚
- Hook æ˜¯ä»¥ `use` å¼€å¤´çš„ç‰¹æ®Šå‡½æ•°ã€‚å®ƒä»¬èƒ½è®©ä½  â€œhookâ€ åˆ°åƒ state è¿™æ ·çš„ React ç‰¹æ€§ä¸­ã€‚
- Hook å¯èƒ½ä¼šè®©ä½ æƒ³èµ· importï¼šå®ƒä»¬éœ€è¦åœ¨éæ¡ä»¶è¯­å¥ä¸­è°ƒç”¨ã€‚è°ƒç”¨ Hook æ—¶ï¼ŒåŒ…æ‹¬ `useState`ï¼Œä»…åœ¨ç»„ä»¶æˆ–å¦ä¸€ä¸ª Hook çš„é¡¶å±‚è¢«è°ƒç”¨æ‰æœ‰æ•ˆã€‚
- `useState` Hook è¿”å›ä¸€å¯¹å€¼ï¼šå½“å‰ state å’Œæ›´æ–°å®ƒçš„å‡½æ•°ã€‚
- ä½ å¯ä»¥æ‹¥æœ‰å¤šä¸ª state å˜é‡ã€‚åœ¨å†…éƒ¨ï¼ŒReact æŒ‰é¡ºåºåŒ¹é…å®ƒä»¬ã€‚
- State æ˜¯ç»„ä»¶ç§æœ‰çš„ã€‚å¦‚æœä½ åœ¨ä¸¤ä¸ªåœ°æ–¹æ¸²æŸ“å®ƒï¼Œåˆ™æ¯ä¸ªå‰¯æœ¬éƒ½æœ‰ç‹¬å±äºè‡ªå·±çš„ stateã€‚
- åœ¨ä¸€ä¸ª React åº”ç”¨ä¸­ä¸€æ¬¡å±å¹•æ›´æ–°éƒ½ä¼šå‘ç”Ÿä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š

    è§¦å‘

    æ¸²æŸ“

    æäº¤

### æ‰¹å¤„ç†

è®¾ç½®ç»„ä»¶ state ä¼šæŠŠä¸€æ¬¡é‡æ–°æ¸²æŸ“åŠ å…¥é˜Ÿåˆ—ã€‚

**React ä¼šç­‰åˆ°äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ *****æ‰€æœ‰***** ä»£ç éƒ½è¿è¡Œå®Œæ¯•å†å¤„ç†ä½ çš„ state æ›´æ–°**

ï¼ˆé¤å…é‡Œå¸®ä½ ç‚¹èœçš„æœåŠ¡å‘˜ã€‚æœåŠ¡å‘˜ä¸ä¼šåœ¨ä½ è¯´ç¬¬ä¸€é“èœçš„æ—¶å€™å°±è·‘åˆ°å¨æˆ¿ï¼ç›¸åï¼Œä»–ä»¬ä¼šè®©ä½ æŠŠèœç‚¹å®Œï¼Œè®©ä½ ä¿®æ”¹èœå“ï¼Œç”šè‡³ä¼šå¸®æ¡Œä¸Šçš„å…¶ä»–äººç‚¹èœã€‚ï¼‰

```react&#x20;tsx
setNumber(0 + 1);//1
setNumber(0 + 1);//1
setNumber(0 + 1);//1
```

#### åœ¨ä¸‹æ¬¡æ¸²æŸ“å‰å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ª state

ä½†æ˜¯å¦‚æœä½ æƒ³åœ¨ä¸‹æ¬¡æ¸²æŸ“ä¹‹å‰å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ª stateï¼Œä½ å¯ä»¥åƒ `setNumber(n => n + 1)` è¿™æ ·ä¼ å…¥ä¸€ä¸ª**æ ¹æ®é˜Ÿåˆ—ä¸­çš„å‰ä¸€ä¸ª state è®¡ç®—ä¸‹ä¸€ä¸ª state çš„ *****å‡½æ•°***ï¼Œè€Œä¸æ˜¯åƒ `setNumber(number + 1)` è¿™æ ·ä¼ å…¥ *ä¸‹ä¸€ä¸ª state å€¼*ã€‚è¿™æ˜¯ä¸€ç§å‘Šè¯‰ React â€œç”¨ state å€¼åšæŸäº‹â€è€Œä¸æ˜¯ä»…ä»…**æ›¿æ¢å®ƒ**çš„æ–¹æ³•ã€‚

```react&#x20;tsx
setNumber(n => n + 1);
setNumber(n => n + 1);
setNumber(n => n + 1);
```

`n => n + 1` è¢«ç§°ä¸º **æ›´æ–°å‡½æ•°**

ä¼ é€’ç»™ `setNumber` state è®¾ç½®å‡½æ•°çš„å†…å®¹ï¼š

- **ä¸€ä¸ªæ›´æ–°å‡½æ•°**ï¼ˆä¾‹å¦‚ï¼š`n => n + 1`ï¼‰ä¼šè¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚
- **ä»»ä½•å…¶ä»–çš„å€¼**ï¼ˆä¾‹å¦‚ï¼šæ•°å­— `5`ï¼‰ä¼šå¯¼è‡´â€œæ›¿æ¢ä¸º `5`â€è¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œå·²ç»åœ¨é˜Ÿåˆ—ä¸­çš„å†…å®¹ä¼šè¢«å¿½ç•¥ã€‚

äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæˆåï¼ŒReact å°†è§¦å‘é‡æ–°æ¸²æŸ“ã€‚åœ¨é‡æ–°æ¸²æŸ“æœŸé—´ï¼ŒReact å°†å¤„ç†é˜Ÿåˆ—ã€‚æ›´æ–°å‡½æ•°ä¼šåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œï¼Œå› æ­¤ \*\*æ›´æ–°å‡½æ•°å¿…é¡»æ˜¯ \*\*[**çº¯å‡½æ•°**](https://zh-hans.react.dev/learn/keeping-components-pure "çº¯å‡½æ•°") å¹¶ä¸”åª *è¿”å›* ç»“æœã€‚ä¸è¦å°è¯•ä»å®ƒä»¬å†…éƒ¨è®¾ç½® state æˆ–è€…æ‰§è¡Œå…¶ä»–å‰¯ä½œç”¨ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒReact ä¼šæ‰§è¡Œæ¯ä¸ªæ›´æ–°å‡½æ•°ä¸¤æ¬¡ï¼ˆä½†æ˜¯ä¸¢å¼ƒç¬¬äºŒä¸ªç»“æœï¼‰ä»¥ä¾¿å¸®åŠ©ä½ å‘ç°é”™è¯¯ã€‚

#### å‘½åæƒ¯ä¾‹

é€šå¸¸å¯ä»¥é€šè¿‡ç›¸åº” state å˜é‡çš„ç¬¬ä¸€ä¸ªå­—æ¯æ¥å‘½åæ›´æ–°å‡½æ•°çš„å‚æ•°ï¼š

```react&#x20;tsx
setEnabled(e => !e);
setLastName(ln => ln.reverse());
setFriendCount(fc => fc * 2);
```

> æ³¨æ„ï¼šsetStateçš„â€œå¼‚æ­¥â€å¹¶ä¸æ˜¯è¯´å†…éƒ¨ç”±å¼‚æ­¥ä»£ç å®ç°ï¼Œå…¶å®æœ¬èº«æ‰§è¡Œçš„è¿‡ç¨‹å’Œä»£ç éƒ½æ˜¯åŒæ­¥çš„ï¼Œåªæ˜¯åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°çš„è°ƒç”¨é¡ºåºåœ¨æ›´æ–°ä¹‹å‰ï¼Œå¯¼è‡´åœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­æ²¡æ³•ç«‹é©¬æ‹¿åˆ°æ›´æ–°åçš„å€¼ï¼Œå½¢å¼äº†æ‰€è°“çš„â€œå¼‚æ­¥â€ï¼Œå½“ç„¶å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•° setState(partialState, callback) ä¸­çš„callbackæ‹¿åˆ°æ›´æ–°åçš„ç»“æœã€‚

<https://github.com/sisterAn/blog/issues/26>

### useState - å›è°ƒå‡½æ•°çš„å‚æ•°

**ä½¿ç”¨åœºæ™¯**
å‚æ•°åªä¼šåœ¨ç»„ä»¶çš„åˆå§‹æ¸²æŸ“ä¸­èµ·ä½œç”¨ï¼Œåç»­æ¸²æŸ“æ—¶ä¼šè¢«å¿½ç•¥ã€‚å¦‚æœåˆå§‹ state éœ€è¦é€šè¿‡è®¡ç®—æ‰èƒ½è·å¾—ï¼Œåˆ™å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°ä¸­è®¡ç®—å¹¶è¿”å›åˆå§‹çš„ stateï¼Œæ­¤å‡½æ•°åªåœ¨åˆå§‹æ¸²æŸ“æ—¶è¢«è°ƒç”¨

```react&#x20;tsx
const [name, setName] = useState(()=>{   
  // ç¼–å†™è®¡ç®—é€»è¾‘    return 'è®¡ç®—ä¹‹åçš„åˆå§‹å€¼'
})
```

**è¯­æ³•è§„åˆ™**

  1. å›è°ƒå‡½æ•°returnå‡ºå»çš„å€¼å°†ä½œä¸º `name` çš„åˆå§‹å€¼
  2. å›è°ƒå‡½æ•°ä¸­çš„é€»è¾‘åªä¼šåœ¨ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡

**è¯­æ³•é€‰æ‹©**

1. å¦‚æœå°±æ˜¯åˆå§‹åŒ–ä¸€ä¸ªæ™®é€šçš„æ•°æ® ç›´æ¥ä½¿ç”¨ `useState(æ™®é€šæ•°æ®)` å³å¯
2. å¦‚æœè¦åˆå§‹åŒ–çš„æ•°æ®æ— æ³•ç›´æ¥å¾—åˆ°éœ€è¦é€šè¿‡è®¡ç®—æ‰èƒ½è·å–åˆ°ï¼Œä½¿ç”¨`useState(()=>{})`

```react&#x20;tsx
import { useState } from 'react'

function Counter(props) {
  const [count, setCount] = useState(() => {
    return props.count //åˆå§‹å€¼ä¸ºè°ƒç”¨ç»„ä»¶çš„æ—¶å€™ä¼ å…¥
  })
  return (
    <div>
      <button onClick={() => setCount(count + 1)}>{count}</button>
    </div>
  )
}

function App() {
  return (
    <>
      <Counter count={10} />
      <Counter count={20} />
    </>
  )
}

export default App
```

## useEffect

**ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨**
å‰¯ä½œç”¨æ˜¯ç›¸å¯¹äºä¸»ä½œç”¨æ¥è¯´çš„ï¼Œä¸€ä¸ªå‡½æ•°é™¤äº†ä¸»ä½œç”¨ï¼Œå…¶ä»–çš„ä½œç”¨å°±æ˜¯å‰¯ä½œç”¨ã€‚å¯¹äº React ç»„ä»¶æ¥è¯´ï¼Œ**ä¸»ä½œç”¨å°±æ˜¯æ ¹æ®æ•°æ®ï¼ˆstate/propsï¼‰æ¸²æŸ“ UI**ï¼Œé™¤æ­¤ä¹‹å¤–éƒ½æ˜¯å‰¯ä½œç”¨ï¼ˆæ¯”å¦‚ï¼Œæ‰‹åŠ¨ä¿®æ”¹ DOMï¼‰

**å¸¸è§çš„å‰¯ä½œç”¨**

1. æ•°æ®è¯·æ±‚ ajaxå‘é€
2. æ‰‹åŠ¨ä¿®æ”¹dom
3. localstorageæ“ä½œ

    useEffectå‡½æ•°çš„ä½œç”¨å°±æ˜¯ä¸ºreactå‡½æ•°ç»„ä»¶æä¾›å‰¯ä½œç”¨å¤„ç†çš„

`useEffect`å‡½æ•°ä¼šåœ¨æµè§ˆå™¨å®Œæˆå¸ƒå±€å’Œç»˜åˆ¶ä¹‹åï¼Œä¸‹ä¸€æ¬¡é‡æ–°æ¸²æŸ“ä¹‹å‰æ‰§è¡Œï¼Œä¿è¯ä¸ä¼šé˜»å¡æµè§ˆå™¨å¯¹å±å¹•çš„æ›´æ–°

`useEffect` çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ effect çš„å›è°ƒï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ deps ä¾èµ–é¡¹ï¼Œå¯é€‰ï¼Œç±»å‹æ˜¯æ•°ç»„ï¼Œä¼šæ ¹æ®ä¾èµ–é¡¹ï¼Œå†³å®šæ˜¯å¦è°ƒç”¨ EffectCallbackã€‚

### *useEffect* ä¾èµ–é¡¹

### ä¸€ã€ä¸ä¼ ä¾èµ–é¡¹

**è°ƒç”¨æ—¶æœºï¼š** åœ¨ä¸ä¼  deps ä¾èµ–é¡¹æƒ…å†µä¸‹ï¼Œ*useEffect*Â ä¼šåœ¨**æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œ**ï¼Œå³å®ƒåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹å\_å’Œ\_æ¯æ¬¡æ›´æ–°ä¹‹åéƒ½ä¼šæ‰§è¡Œã€‚ç›¸å½“äºåœ¨ `componentDidMount` å’Œ `componentDidUpdate` ä¸¤ä¸ªç±»æ–¹æ³•ä¸­æ‰§è¡Œã€‚

é€‚åˆäº effect çš„å›è°ƒé‡Œè®¡ç®—é‡å°ï¼Œä¸ä¼šè§¦å‘æ¸²æŸ“çš„æƒ…å½¢ã€‚

### äºŒã€ä¾èµ–é¡¹ä¸ºç©ºæ•°ç»„

**è°ƒç”¨æ—¶æœºï¼š** å½“ä¸éœ€è¦åœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œï¼Œå¸Œæœ›**åªåœ¨å®ƒç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åæ‰§è¡Œ**ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ *useEffect* çš„ä¾èµ–é¡¹è®¾ä¸ºç©ºæ•°ç»„ï¼Œç›¸å½“äºä»¥å‰çš„ class ç»„ä»¶çš„ `componentDidMount`ã€‚

ä¾‹å­ï¼š

1. è®¾å®š Interval å®šæ—¶å™¨ã€‚

    è®© state count æ¯ç§’è‡ªåŠ ä¸€ã€‚å¦‚æœä¸ä¼ ä¾èµ–é¡¹ï¼Œå°±ä¼šæ¯ç§’éƒ½ `setInterval`, ä¸ç¬¦åˆéœ€æ±‚ã€‚æ­£ç¡®åšæ³•æ˜¯ï¼Œåªåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“ä¹‹åæ‰§è¡Œã€‚

    ```react&#x20;tsx
    function Count(){
      const [index, setIndex] = useState(0)
      
      useEffect(()=>{
        const id = setInterval(() => {
          setIndex(index => index+1)
        }, 1000)
      }, [])
    }
    ```

2. è¿›è¡Œæ•°æ®è¯·æ±‚ã€‚

    ```react&#x20;tsx
    function Comment(){
      const [commentList, setCommentList] = setState([])
      
      useEffect(() => {
        getComList().then(res => {
          setCommentList(res.data)
        })
      },[])
    }
    ```

### ä¸‰ã€ä¾èµ–é¡¹ä¸ºéç©ºæ•°ç»„

**è°ƒç”¨æ—¶æœºï¼š** å½“ä¾èµ–é¡¹ä¸ºéç©ºæ•°ç»„ï¼Œåˆ™ **åœ¨æ¯æ¬¡æ¸²æŸ“åï¼Œéç©ºæ•°ç»„ä¸Šçš„ state æœ‰æ›´æ–°**æ—¶ï¼Œå°±ä¼šæ‰§è¡Œ *EffectCallback*ï¼Œå³ *useEffect* ä¼ å…¥å›è°ƒå‡½æ•°ã€‚

> ğŸ“Œ**è¿™é‡Œçš„æ›´æ–°æ˜¯æŒ‡ä»€ä¹ˆå‘¢ï¼Ÿæ˜¯æŒ‡å¯¹ä¾èµ–é¡¹è¿›è¡Œæµ…æ¯”è¾ƒ**ï¼Œå¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªstateï¼Œè¿›è¡Œä¸Šæ¬¡æ¸²æŸ“åçš„å€¼ï¼Œè·Ÿè¿™æ¬¡æ¸²æŸ“åçš„å€¼ï¼Œè¿›è¡Œ**æµ…æ¯”è¾ƒ**ï¼Œä¸ç›¸ç­‰æ—¶ï¼Œå°±æ‰§è¡Œ *EffectCallback*ã€‚
>
> > å¯¹äº**å€¼ç±»å‹çš„æµ…æ¯”è¾ƒæ˜¯å¯¹æ¯”å€¼æ˜¯å¦ç›¸ç­‰**ã€‚
> >
> > å¯¹äº**å¼•ç”¨ç±»å‹çš„æµ…æ¯”è¾ƒæ˜¯å¯¹æ¯”å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯¹æ¯”å¯¹è±¡æŒ‡å‘çš„å†…å­˜åœ°å€**ã€‚ï¼ˆå½“ä¾èµ–é¡¹æ˜¯å¼•ç”¨ç±»å‹æ—¶ï¼ŒReact ä¼šå¯¹æ¯”å½“å‰æ¸²æŸ“ä¸‹çš„ä¾èµ–é¡¹å’Œä¸Šæ¬¡æ¸²æŸ“ä¸‹çš„ä¾èµ–é¡¹çš„å†…å­˜åœ°å€æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œ`effect` ä¸ä¼šæ‰§è¡Œï¼Œåªæœ‰å½“å¯¹æ¯”ç»“æœä¸ä¸€è‡´æ—¶ï¼Œ`effect` æ‰ä¼šæ‰§è¡Œã€‚

### å››ã€æ¸…ç†å‰¯ä½œç”¨

å¦‚æœæƒ³è¦æ¸…ç†å‰¯ä½œç”¨ å¯ä»¥åœ¨å‰¯ä½œç”¨å‡½æ•°ä¸­çš„æœ«å°¾returnä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨æ–°çš„å‡½æ•°ä¸­ç¼–å†™æ¸…ç†å‰¯ä½œç”¨çš„é€»è¾‘

æ³¨æ„æ‰§è¡Œæ—¶æœºä¸ºï¼š

1. ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ‰§è¡Œ

    ```react&#x20;tsx
    function Count(){
      const [index, setIndex] = useState(0)
      
      useEffect(()=>{
        const id = setInterval(() => {
          setIndex(index => index+1)
        }, 1000)
        return ()=> clearInterval(id)
      }, [])
    }
    ```

2. ç»„ä»¶æ›´æ–°æ—¶ï¼Œä¸‹ä¸€ä¸ªuseEffectå‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œä¹‹å‰è‡ªåŠ¨æ‰§è¡Œ

    ```react&#x20;tsx
    import { useEffect, useState } from "react"

    const App = () => {
      const [count, setCount] = useState(0)
      useEffect(() => {
        const timerId = setInterval(() => {
          setCount(count + 1)
        }, 1000)
        return () => {
          // ç”¨æ¥æ¸…ç†å‰¯ä½œç”¨çš„äº‹æƒ…
          clearInterval(timerId)
        }
      }, [count])
      return (
        <div>
          {count}
        </div>
      )
    }

    export default App
    ```

### äº”ã€useEffect - å‘é€ç½‘ç»œè¯·æ±‚

åœ¨useEffectä¸­å‘é€ç½‘ç»œè¯·æ±‚ï¼Œå¹¶ä¸”å°è£…åŒæ­¥ async awaitæ“ä½œ

```react&#x20;tsx
useEffect(()=>{   
    async function fetchData(){      
       const res = await axios.get('http://geek.itheima.net/v1_0/channels')                            console.log(res)   
    } 
},[])
```

**è¯­æ³•è¦æ±‚**
ä¸å¯ä»¥ç›´æ¥åœ¨useEffectçš„å›è°ƒå‡½æ•°å¤–å±‚ç›´æ¥åŒ…è£¹ await ï¼Œå› ä¸º**å¼‚æ­¥ä¼šå¯¼è‡´æ¸…ç†å‡½æ•°æ— æ³•ç«‹å³è¿”å›**

```react&#x20;tsx
é”™è¯¯çš„ï¼š
useEffect(async ()=>{    
    const res = await axios.get('http://geek.itheima.net/v1_0/channels')   
    console.log(res)
},[])
```

## useRef

### ä½¿ç”¨åœºæ™¯

åœ¨å‡½æ•°ç»„ä»¶ä¸­è·å–çœŸå®çš„domå…ƒç´ å¯¹è±¡æˆ–è€…æ˜¯ç»„ä»¶å¯¹è±¡

useRef æœ‰ä¸€ä¸ªåä¸º current çš„å±æ€§ï¼Œç”¨äºåœ¨ä»»ä½•æ—¶å€™æ£€ç´¢è¢«å¼•ç”¨å¯¹è±¡çš„å€¼ï¼ŒåŒæ—¶ä¹Ÿæ¥å—ä¸€ä¸ªåˆå§‹å€¼ä½œä¸ºå‚æ•°ã€‚ä½ å¯ä»¥é€šè¿‡æ›´æ–°å½“å‰å€¼æ¥æ›´æ”¹å¼•ç”¨å¯¹è±¡çš„å€¼ã€‚

```react&#x20;tsx
import { useRef } from â€˜reactâ€™

const myComponent = () => {
  const refObj = useRef(initialValue)
  
  return (
  //â€¦
  )
}
```

```react&#x20;tsx
// åœ¨å‡½æ•°å†…éƒ¨
const handleRefUpdate = () => {
    // è®¿é—®è¢«å¼•ç”¨å¯¹è±¡çš„å€¼
    const value = refObj.current

    // æ›´æ–°è¢«å¼•ç”¨å¯¹è±¡çš„å€¼
   refObj.current = newValue
}
```

- è¢«å¼•ç”¨å¯¹è±¡çš„å€¼åœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´ä¿æŒä¸å˜ã€‚
- æ›´æ–°è¢«å¼•ç”¨å¯¹è±¡çš„å€¼ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚

### ä½¿ç”¨æ­¥éª¤

1. å¯¼å…¥ `useRef` å‡½æ•°
2. æ‰§è¡Œ `useRef` å‡½æ•°å¹¶ä¼ å…¥nullï¼Œè¿”å›å€¼ä¸ºä¸€ä¸ªå¯¹è±¡ å†…éƒ¨æœ‰ä¸€ä¸ªcurrentå±æ€§å­˜æ”¾æ‹¿åˆ°çš„domå¯¹è±¡ï¼ˆç»„ä»¶å®ä¾‹ï¼‰
3. é€šè¿‡ref ç»‘å®š è¦è·å–çš„å…ƒç´ æˆ–è€…ç»„ä»¶
4. **è·å–Dom**

    ```react&#x20;tsx
    import { useEffect, useRef } from 'react'
    function App() {  
        const h1Ref = useRef(null)  
        useEffect(() => {    
            console.log(h1Ref)  
        },[])  
        return (    
            <div>      
                <h1 ref={ h1Ref }>this is h1</h1>    
            </div>  
        )
    }
    export default App
    ```

5. **è·å–ç»„ä»¶å®ä¾‹**
    > å‡½æ•°ç»„ä»¶ç”±äºæ²¡æœ‰å®ä¾‹ï¼Œä¸èƒ½ä½¿ç”¨refè·å–ï¼Œå¦‚æœæƒ³è·å–ç»„ä»¶å®ä¾‹ï¼Œå¿…é¡»æ˜¯**ç±»ç»„ä»¶**

    ```react&#x20;tsx
    class Foo extends React.Component {  
        sayHi = () => {    
            console.log('say hi')  
        }  
        render(){    
            return <div>Foo</div>  
        }
    }
        
    export default Foo
    ```

    ```react&#x20;tsx
    import { useEffect, useRef } from 'react'
    import Foo from './Foo'
    function App() {  
        const h1Foo = useRef(null)  
        useEffect(() => {    
            console.log(h1Foo)  
        }, [])  
        return (    
            <div> <Foo ref={ h1Foo } /></div>  
        )
    }
    export default App
    ```

&#x20;

### è‡ªå®šä¹‰ä¸€ä¸ªhook

åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰ hookï¼Œå®ƒæ¥å—ä¸€ä¸ªå¼•ç”¨å¯¹è±¡ä½œä¸º `ref` å’Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç„¶åæˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨æ¥æ£€æŸ¥é¼ æ ‡ä½•æ—¶è¢«å•å‡»ï¼Œå¦‚æœå•å‡»ä¸åœ¨å½“å‰çš„ `ref` ä¸Šï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è§¦å‘å›è°ƒå‡½æ•°ã€‚

```react&#x20;tsx
import React, { useEffect } from 'react'
 
export default function useClickAway(ref: any, callback: Function) {
  useEffect(() => {
    function handleClickAway(event: any) {
      if (ref.current && !ref.current.contains(event.target)) { //********/
        callback();
      }
    }
    document.addEventListener("mousedown", handleClickAway);
    return () => {
      document.removeEventListener("mousedown", handleClickAway);
    };
  }, [ref]);
 };
```

**éœ€æ±‚æè¿°**ï¼šè‡ªå®šä¹‰ä¸€ä¸ªhookå‡½æ•°ï¼Œå®ç°è·å–æ»šåŠ¨è·ç¦»Y

```react&#x20;tsx
import { useState, useEffect } from "react"

export function useWindowScroll () {
  const [y, setY] = useState(0)
  useEffect(()=>{
     const scrollHandler = () => {
        const h = document.documentElement.scrollTop
        setY(h)
     })
     window.addEventListener('scroll', scrollHandler)
     return () => window.removeEventListener('scroll', scrollHandler)
  })
 
  return [y]
}
```

**éœ€æ±‚æè¿°ï¼š** è‡ªå®šä¹‰hookå‡½æ•°ï¼Œå¯ä»¥è‡ªåŠ¨åŒæ­¥åˆ°æœ¬åœ°LocalStorage

> `const [message, setMessage] = useLocalStorage(keyï¼ŒdefaultValue)`
>
> 1. messageå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ä¼ å…¥é»˜è®¤åˆå§‹å€¼
> 2. æ¯æ¬¡ä¿®æ”¹messageæ•°æ®çš„æ—¶å€™ éƒ½ä¼šè‡ªåŠ¨å¾€æœ¬åœ°åŒæ­¥ä¸€ä»½

```react&#x20;tsx
import { useEffect, useState } from 'react'

export function useLocalStorage (key, defaultValue) {
  const [message, setMessage] = useState(defaultValue)
  // æ¯æ¬¡åªè¦messageå˜åŒ– å°±ä¼šè‡ªåŠ¨åŒæ­¥åˆ°æœ¬åœ°ls
  useEffect(() => {
    window.localStorage.setItem(key, message)
  }, [message, key])
  return [message, setMessage]
}
```

## useMemo/useCallback

`useMemo(()=>{},[])`

useMemoæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯å‡½æ•°å’Œä¸€ä¸ªæ•°ç»„ï¼ˆå®é™…ä¸Šæ˜¯ä¾èµ–ï¼‰ï¼Œå‡½æ•°é‡Œreturn å‡½æ•°ï¼Œæ•°ç»„å†…å­˜æ”¾ä¾èµ–ã€‚

```react&#x20;tsx
const addM = useMemo(() => {
    return () => {
      setM({ m: m.m + 1 });
    };
  }, [m]); //è¡¨ç¤ºç›‘æ§må˜åŒ–
```

useCallback

è¯­æ³•ç³–

```react&#x20;tsx
  const addM = useCallback(() => {
    setM({ m: m.m + 1 });
  }, [m]);
```

- ä½¿ç”¨`memo`å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¼˜åŒ–æ€§èƒ½ï¼Œè®©`react`æ²¡å¿…è¦æ‰§è¡Œä¸å¿…è¦çš„å‡½æ•°
- ç”±äºå¤æ‚æ•°æ®ç±»å‹çš„åœ°å€å¯èƒ½å‘ç”Ÿæ”¹å˜ï¼Œäºæ˜¯ä¼ é€’ç»™å­ç»„ä»¶çš„`props`ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™æ ·è¿˜æ˜¯ä¼šæ‰§è¡Œä¸å¿…è¦çš„å‡½æ•°ï¼Œæ‰€ä»¥å°±ç”¨åˆ°äº†`useMemo`è¿™ä¸ªapi
- `useCallback`æ˜¯`useMemo`çš„è¯­æ³•ç³–

`useMemo` å’Œ `useCallback` éƒ½æ˜¯ç”¨æ¥å¸®åŠ©æˆ‘ä»¬ä¼˜åŒ– **é‡æ–°æ¸²æŸ“**

- å‡å°‘åœ¨ä¸€æ¬¡æ¸²æŸ“ä¸­éœ€è¦å®Œæˆçš„å·¥ä½œé‡ã€‚
- å‡å°‘ä¸€ä¸ªç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“çš„æ¬¡æ•°ã€‚

<https://juejin.cn/post/7165338403465068552>

<http://docs.lanhanba.net/fe/@lhb%2Fhook?name=docs>

## useContext

**å®ç°æ­¥éª¤**

1. ä½¿ç”¨`createContext` åˆ›å»ºContextå¯¹è±¡
2. åœ¨é¡¶å±‚ç»„ä»¶é€šè¿‡`Provider` æä¾›æ•°æ®
3. åœ¨åº•å±‚ç»„ä»¶é€šè¿‡`useContext`å‡½æ•°è·å–æ•°æ®

```react&#x20;tsx
import { createContext, useContext } from 'react'
// åˆ›å»ºContextå¯¹è±¡
const Context = createContext()

function Foo() {  
    return <div>Foo <Bar/></div>
}

function Bar() {  
    // åº•å±‚ç»„ä»¶é€šè¿‡useContextå‡½æ•°è·å–æ•°æ®  
    const name = useContext(Context)  
    return <div>Bar {name}</div>
}

function App() {  
    return (    
        // é¡¶å±‚ç»„ä»¶é€šè¿‡Provider æä¾›æ•°æ®    
        <Context.Provider value={'this is name'}>     
            <div><Foo/></div>    
        </Context.Provider>  
    )
}

export default App
```

```react&#x20;tsx
interface paramsType {
//çœid
provinceId: number ;
//åŸå¸‚id
cityId: number;
//åŒºåŸŸidï¼›
districtId: numberï¼›
}
```
